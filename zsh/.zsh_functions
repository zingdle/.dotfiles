# proxy
function px {
  PROXY=http://127.0.0.1:8118
  export HTTP_PROXY=PROXY
  export HTTPS_PROXY=$PROXY
  export ALL_PROXY=$PROXY
  curl ifconfig.co/json
}

function upx {
  unset HTTP_PROXY
  unset HTTPS_PROXY
  unset ALL_PROXY
  curl ifconfig.co/json
}


# brew
function brew {
  PATH="$BREW/bin:$BREW/sbin:$PATH" $BREW/bin/brew "$@"
}

function brlk {
  mkdir -p $HOME/.local/bin
  ln -s $BREW/bin/$1 $HOME/.local/bin/$1
}


# process
function fp {
  ps -ef | sed 1d | fzf -m --header='[find:process]' | awk '{print $2}'
}

function kp {
  tty=$(tty)

  if [ "$UID" != "0" ]; then
    pid=$(ps -f -u $UID | sed 1d | fzf -m --header='[kill:process]' | awk '{print $2}')
  else
    pid=$(ps -ef | sed 1d | fzf -m --header='[kill:process]' | awk '{print $2}')
  fi

  if [ "x$pid" != "x" ]; then
    echo $pid | tee $tty | xargs kill -${1:-9}
  fi
}

function gdbp {
  PID=$(ps -ef | sed 1d | fzf --header='[attach:process]' | awk '{print $2}')
  [[ ! -z "$PID" ]] && gdb -p $PID
}


# http server
function server {
  hostname -I
  python3 -m http.server || python -m SimpleHTTPServer || echo doing nothing...
}


# docker
function dockertags {
  # https://stackoverflow.com/questions/28320134/how-can-i-list-all-tags-for-a-docker-image-on-a-remote-registry
  if [ $# -lt 1 ];then
    echo "dockertags  --  list all tags for a Docker image on a remote registry."
    echo
    echo "EXAMPLE:"
    echo "- list all tags for ubuntu:"
    echo "   dockertags ubuntu"
    echo
    echo "- list all php tags containing apache:"
    echo "   dockertags php apache"
  fi

  image="$1"
  tags=`wget -q https://registry.hub.docker.com/v1/repositories/${image}/tags -O -  | sed -e 's/[][]//g' -e 's/"//g' -e 's/ //g' | tr '}' '\n'  | awk -F: '{print $3}'`

  if [ -n "$2" ];then
      tags=` echo "${tags}" | grep "$2" `
  fi

  echo "${tags}"
}
